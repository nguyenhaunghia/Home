<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TỔ TOÁN - TIN | Science & Tech Hub</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Rajdhani:wght@500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            /* Palette Tech/Science */
            --bg-deep: #020617;
            --bg-card: rgba(15, 23, 42, 0.65);
            --border-tech: rgba(56, 189, 248, 0.3);
            --primary-neon: #0ea5e9;
            --text-glow: #e2e8f0;
            --text-dim: #94a3b8;
        }

        html,
        body {
            min-height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            color: var(--text-glow);
            background-color: var(--bg-deep);
            overflow-x: hidden;
            /* Chặn cuộn ngang toàn trang */
        }

        /* --- BACKGROUND: SPACE + GRID --- */
        body {
            background-image:
                radial-gradient(circle at 50% 50%, transparent 40%, #020617 100%),
                linear-gradient(rgba(6, 182, 212, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.08) 1px, transparent 1px),
                radial-gradient(circle at 50% 0%, rgba(14, 165, 233, 0.15), transparent 70%);
            background-size: 100% 100%, 50px 50px, 50px 50px, 100% 100%;
            background-position: center;
            background-attachment: fixed;
        }

        /* Canvas sao bay nền sau */
        #hero-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* --- HEADER --- */
        .page-header {
            text-align: center;
            padding-top: 50px;
            margin-bottom: 40px;
            position: relative;
            z-index: 10;
        }

        .tech-badge {
            display: inline-block;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: #22d3ee;
            border: 1px solid rgba(34, 211, 238, 0.4);
            padding: 4px 12px;
            border-radius: 4px;
            background: rgba(8, 145, 178, 0.15);
            margin-bottom: 15px;
            letter-spacing: 2px;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.2);
        }

        .page-header h1 {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 3.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 40px rgba(14, 165, 233, 0.6);
        }

        /* --- LAYOUT GRID 3xN --- */
        .dashboard-container {
            width: 100%;
            max-width: 1400px;
            /* Giới hạn chiều rộng để không bị quá bè trên màn hình lớn */
            margin: 0 auto;
            padding: 0 20px 60px 20px;
        }

        .edu-grid {
            display: grid;
            /* QUAN TRỌNG: Chia 3 cột bằng nhau */
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            /* Khoảng cách giữa các card */
            width: 100%;
        }

        /* Responsive: Xuống 2 cột trên Tablet, 1 cột trên Mobile */
        @media (max-width: 1100px) {
            .edu-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .edu-grid {
                grid-template-columns: 1fr;
            }

            .page-header h1 {
                font-size: 2.2rem;
            }
        }

        .edu-col {
            opacity: 0;
            animation: slideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- CARD STYLE MỚI --- */
        .edu-card {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 12px;
            /* Không set chiều cao cứng (height) cho card tổng, để nó co giãn theo nội dung */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .edu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(6, 182, 212, 0.15);
            border-color: rgba(34, 211, 238, 0.5);
        }

        .card-header-block {
            padding: 15px 20px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03) 0%, transparent 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .edu-icon-box {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .edu-title {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: #fff;
            margin: 0;
            text-transform: uppercase;
        }

        /* --- MENU SCROLL AREA (QUAN TRỌNG) --- */
        .edu-menu {
            padding: 10px 15px;
            /* Chiều cao 1 dòng ~ 45px. 
               5 dòng ~ 225px. 
               Set max-height để hiện thanh cuộn nếu quá dài.
               Set min-height để các card trông đều nhau nếu ít nội dung.
            */
            height: 240px;
            overflow-y: auto;
            /* Bật thanh cuộn dọc */
        }

        /* Tùy chỉnh thanh cuộn đẹp (Scrollbar Styling) */
        .edu-menu::-webkit-scrollbar {
            width: 4px;
            /* Thanh cuộn mảnh */
        }

        .edu-menu::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
        }

        .edu-menu::-webkit-scrollbar-thumb {
            background: rgba(34, 211, 238, 0.4);
            /* Màu Cyan mờ */
            border-radius: 2px;
        }

        .edu-menu::-webkit-scrollbar-thumb:hover {
            background: #22d3ee;
            /* Sáng lên khi hover */
        }

        .edu-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 5px;
            color: var(--text-dim);
            font-size: 0.9rem;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
            transition: 0.2s;
            cursor: pointer;
        }

        .edu-menu-item:hover {
            color: #22d3ee;
            padding-left: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-bottom-color: #22d3ee;
        }

        .menu-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Submenu */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s;
            margin-left: 8px;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
        }

        .submenu.active {
            max-height: 500px;
            opacity: 1;
            margin-bottom: 5px;
        }

        .submenu-item {
            padding: 6px 0 6px 12px;
            font-size: 0.85rem;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            transition: 0.2s;
        }

        .submenu-item:hover {
            color: #fff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        .rotate-icon {
            transition: 0.3s;
            font-size: 0.7rem;
        }

        .rotate-icon.active {
            transform: rotate(180deg);
            color: #22d3ee;
        }

        /* --- FOOTER --- */
        .page-footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(2, 6, 23, 0.9);
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: #64748b;
        }

        /* --- LOADER --- */
        .loader-radar {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(34, 211, 238, 0.3);
            border-radius: 50%;
            position: relative;
            animation: radarPulse 2s infinite;
            margin: 0 auto;
        }

        .loader-radar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 50%;
            background: linear-gradient(45deg, transparent 50%, #22d3ee 100%);
            border-radius: 100% 0 0 0;
            transform-origin: 0 0;
            animation: radarSpin 1.5s linear infinite;
        }

        @keyframes radarSpin {
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes radarPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 211, 238, 0.4);
            }

            100% {
                box-shadow: 0 0 0 20px transparent;
            }
        }
    </style>
</head>

<body>
    <canvas id="hero-canvas"></canvas>

    <div class="page-header">
        <h1>TỔ TOÁN - TIN</h1>
        <p style="color:#94a3b8; margin-top:10px;">Ver 2.0.2026</p>
    </div>

    <div class="dashboard-container">
        <div class="edu-grid" id="dynamic-grid">
            <div style="grid-column: 1 / -1; padding: 40px 0; text-align: center;">
                <div class="loader-radar"></div>
                <div style="margin-top:15px; font-family:'Roboto Mono'; color:white;">ACCESSING DATABASE...</div>
            </div>
        </div>
    </div>

    <div class="page-footer">
        <div>DESIGNED BY <span>TOAN TIN GROUP</span> | NGUYỄN HẬU NGHĨA</div>
    </div>

    <script>
        // --- CONFIG ---
        const SHEET_ID = '1HoArwLdyt3SOLSF19L6D5Bhl0GXEYKALb2kPijZLet4';
        const SHEET_NAME = 'CSDL';

        // --- FETCH DATA ---
        async function fetchSheetData() {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                return parseData(json.table.rows);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('dynamic-grid').innerHTML = '<div style="color:red; text-align:center;">Load Failed</div>';
            }
        }

        function parseData(rows) {
            const cards = [];
            let currentCard = null, currentL1 = null, currentL2 = null;

            rows.forEach(row => {
                const c = row.c;
                if (!c || !c[0]) return;
                const level = c[0] ? c[0].v : 0;
                const icon = c[1] ? c[1].v : 'fas fa-cube';
                let color = c[2] ? c[2].v : '#22d3ee';
                if(color === '#000000') color = '#e2e8f0'; 
                const label = c[3] ? c[3].v : 'Undefined';
                const link = c[4] ? c[4].v : '#';
                const note = c[5] ? c[5].v : '';

                const item = { level, icon, color, label, link, note, children: [] };

                if (level === 0) { currentCard = item; cards.push(currentCard); currentL1 = null; }
                else if (level === 1) { if (currentCard) { currentL1 = item; currentCard.children.push(currentL1); currentL2 = null; } }
                else if (level === 2) { if (currentL1) { currentL2 = item; currentL1.children.push(currentL2); } }
                else if (level === 3) { if (currentL2) currentL2.children.push(item); }
            });
            return cards;
        }

        // --- RENDER ---
        function renderDashboard(cards) {
            const grid = document.getElementById('dynamic-grid');
            grid.innerHTML = '';

            cards.forEach((card, index) => {
                const col = document.createElement('div');
                col.className = 'edu-col';
                col.style.animationDelay = `${index * 0.05}s`; // Hiệu ứng xuất hiện lần lượt nhanh hơn chút

                const cardColor = card.color;
                
                const cardHtml = document.createElement('div');
                cardHtml.className = 'edu-card';
                cardHtml.style.borderTop = `3px solid ${cardColor}`;

                const headerHtml = `
                    <div class="card-header-block">
                        <div class="edu-icon-box" style="color:${cardColor}; border-color:${cardColor}50;">
                            <i class="${card.icon}"></i>
                        </div>
                        <h3 class="edu-title">${card.label}</h3>
                    </div>
                `;

                const menuContainer = document.createElement('div');
                menuContainer.className = 'edu-menu';
                // Render children
                if(card.children && card.children.length > 0) {
                    card.children.forEach(child => menuContainer.appendChild(createMenuItem(child)));
                } else {
                    menuContainer.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b; font-size:0.85rem;">Coming Soon</div>`;
                }

                cardHtml.innerHTML = headerHtml;
                cardHtml.appendChild(menuContainer);
                col.appendChild(cardHtml);
                grid.appendChild(col);
            });
        }

        function createMenuItem(item) {
            const hasChildren = item.children && item.children.length > 0;
            const isLevel1 = item.level === 1;
            
            let onClickAttr = '';
            if (hasChildren) onClickAttr = 'onclick="toggleSub(this)"';
            else if (item.link && item.link.length > 5) onClickAttr = `onclick="window.open('${item.link}', '_blank')"`;

            if (isLevel1) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="edu-menu-item" ${onClickAttr} title="${item.note || ''}">
                        <div class="menu-left">
                            <i class="${item.icon}" style="color: ${item.color}; width:20px; text-align:center; font-size:0.9rem;"></i>
                            <span>${item.label}</span>
                        </div>
                        ${hasChildren ? '<i class="fas fa-chevron-down rotate-icon"></i>' : ''}
                    </div>
                `;
                if (hasChildren) {
                    const subDiv = document.createElement('div');
                    subDiv.className = 'submenu';
                    item.children.forEach(c => subDiv.appendChild(createMenuItem(c)));
                    div.appendChild(subDiv);
                }
                return div;
            } else {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <div class="submenu-item" ${onClickAttr} title="${item.note || ''}">
                        <span style="display:flex; align-items:center; gap:8px;">
                            ${item.level === 3 ? '<i class="fas fa-angle-right" style="font-size:0.6rem"></i>' : ''}
                            ${item.label}
                        </span>
                         ${hasChildren ? '<i class="fas fa-chevron-down rotate-icon"></i>' : ''}
                    </div>
                `;
                if (hasChildren) {
                    const subSubDiv = document.createElement('div');
                    subSubDiv.className = 'submenu';
                    item.children.forEach(c => subSubDiv.appendChild(createMenuItem(c)));
                    wrapper.appendChild(subSubDiv);
                }
                return wrapper;
            }
        }

        // --- INTERACTION ---
        function toggleSub(el) {
            let sub = el.nextElementSibling;
            if(!sub) sub = el.parentElement.querySelector('.submenu'); 
            const icon = el.querySelector('.rotate-icon');
            
            if (sub && sub.classList.contains('submenu')) {
                sub.classList.toggle('active');
                if (icon) icon.classList.toggle('active');
            }
        }

        // --- CANVAS BACKGROUND ---
        const canvas = document.getElementById('hero-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = [];
            const count = Math.floor(width / 8); 
            for(let i=0; i<count; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.1, 
                    vy: (Math.random() - 0.5) * 0.1, 
                    size: Math.random() * 1.5,
                    alpha: Math.random()
                });
            }
        }
        function animateCanvas() {
            ctx.clearRect(0, 0, width, height);
            for(let i=0; i<particles.length; i++) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy;
                if(p.x<0) p.x=width; if(p.x>width) p.x=0;
                if(p.y<0) p.y=height; if(p.y>height) p.y=0;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(200, 240, 255, ${p.alpha * 0.5})`;
                ctx.fill();
            }
            requestAnimationFrame(animateCanvas);
        }
        window.addEventListener('resize', initCanvas);

        // --- START ---
        initCanvas();
        animateCanvas();
        fetchSheetData().then(data => {
            if (data) renderDashboard(data);
        });

    </script>
</body>

</html>

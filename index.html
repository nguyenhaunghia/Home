<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TỔ TOÁN - TIN | Science & Tech Hub</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Rajdhani:wght@500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            /* Palette Tech/Science */
            --bg-deep: #020617;
            /* Very Dark Blue */
            --bg-panel: rgba(15, 23, 42, 0.6);
            /* Slate 900 Glass */
            --border-tech: rgba(56, 189, 248, 0.3);
            /* Cyan low opacity */
            --primary-neon: #0ea5e9;
            /* Sky Blue */
            --accent-neon: #8b5cf6;
            /* Violet */
            --text-glow: #e2e8f0;
            --text-dim: #94a3b8;
            --grid-color: rgba(56, 189, 248, 0.05);
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-glow);
            overflow-x: hidden;
        }

        /* --- BACKGROUND GRID & PARTICLES --- */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Hiệu ứng giấy ô ly kỹ thuật */
            background-image:
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -2;
            pointer-events: none;
        }

        /* Hiệu ứng Vignette tối góc màn hình */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 0%, var(--bg-deep) 90%);
            z-index: -2;
            pointer-events: none;
        }

        #hero-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* --- HEADER --- */
        .page-header {
            text-align: center;
            padding-top: 40px;
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
        }

        .tech-badge {
            display: inline-block;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: var(--primary-neon);
            border: 1px solid var(--border-tech);
            padding: 4px 12px;
            border-radius: 4px;
            background: rgba(14, 165, 233, 0.1);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .page-header h1 {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 3.5rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: white;
            margin: 0;
            /* Text Shadow kiểu Neon */
            text-shadow: 0 0 20px rgba(14, 165, 233, 0.6);
        }

        .page-header p {
            color: var(--text-dim);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 10px auto 0;
            font-weight: 400;
            border-left: 2px solid var(--accent-neon);
            padding-left: 15px;
            text-align: left;
            display: inline-block;
        }

        /* --- DASHBOARD CONTAINER --- */
        .dashboard-container {
            width: 100%;
            padding: 20px 0 60px 0;
            overflow-x: auto;
            /* Ẩn scrollbar ngang của body */
        }

        .edu-grid {
            display: flex;
            gap: 30px;
            padding: 20px 50px;
            width: max-content;
            /* Để scroll ngang tự nhiên */
            margin: 0 auto;
        }

        .edu-col {
            width: 380px;
            /* Rộng hơn chút để giống bảng điều khiển */
            opacity: 0;
            animation: slideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
                scale: 0.95;
            }

            to {
                opacity: 1;
                transform: translateY(0);
                scale: 1;
            }
        }

        /* --- TECH CARD STYLE --- */
        .edu-card {
            background: var(--bg-panel);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            /* Viền mỏng tinh tế */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            /* Bo góc ít hơn để nam tính/kỹ thuật hơn */
            height: 550px;
            display: flex;
            flex-direction: column;
            padding: 0;
            /* Padding xử lý bên trong */
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        /* Hiệu ứng quét sáng (Scanner effect) khi hover */
        .edu-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transform: skewX(-20deg);
            transition: 0.5s;
            pointer-events: none;
        }

        .edu-card:hover::after {
            left: 150%;
            transition: 0.7s ease-in-out;
        }

        .edu-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-neon);
            box-shadow: 0 0 25px rgba(14, 165, 233, 0.15);
        }

        /* Header của Card: Giống thanh tiêu đề cửa sổ phần mềm */
        .card-header-block {
            padding: 20px 25px;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .edu-icon-box {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        /* Chấm sáng nhỏ trang trí icon box */
        .edu-icon-box::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            width: 6px;
            height: 6px;
            border-top: 2px solid white;
            border-left: 2px solid white;
            border-radius: 2px 0 0 0;
            opacity: 0.5;
        }

        .edu-icon-box::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: -1px;
            width: 6px;
            height: 6px;
            border-bottom: 2px solid white;
            border-right: 2px solid white;
            border-radius: 0 0 2px 0;
            opacity: 0.5;
        }

        .edu-title {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: #fff;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- CONTENT AREA --- */
        .edu-menu {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px 25px;
        }

        /* Scrollbar mảnh kiểu tech */
        .edu-menu::-webkit-scrollbar {
            width: 4px;
        }

        .edu-menu::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .edu-menu::-webkit-scrollbar-thumb {
            background: var(--border-tech);
            border-radius: 2px;
        }

        .edu-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            color: var(--text-dim);
            font-size: 0.95rem;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            /* Đường kẻ đứt nét */
            transition: 0.2s;
            cursor: pointer;
        }

        .edu-menu-item:hover {
            color: var(--primary-neon);
            padding-left: 10px;
            border-bottom-color: var(--primary-neon);
        }

        .menu-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Cấu trúc cây thư mục (Submenu) */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.4s;
            margin-left: 10px;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
        }

        .submenu.active {
            max-height: 800px;
            opacity: 1;
            margin-bottom: 10px;
            margin-top: 5px;
        }

        .submenu-item {
            padding: 8px 0 8px 15px;
            font-size: 0.9rem;
            color: #94a3b8;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: 0.2s;
        }

        /* Line nối ngang */
        .submenu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 10px;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .submenu-item:hover {
            color: #fff;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.05), transparent);
        }

        .rotate-icon {
            transition: 0.3s;
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .rotate-icon.active {
            transform: rotate(180deg);
            color: var(--primary-neon);
        }

        /* --- FOOTER --- */
        .page-footer {
            text-align: center;
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(2, 6, 23, 0.8);
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .page-footer span {
            color: var(--primary-neon);
        }

        /* --- ANIMATED LOADER (RADAR) --- */
        .loader-radar {
            width: 60px;
            height: 60px;
            border: 2px solid var(--border-tech);
            border-radius: 50%;
            position: relative;
            animation: radarPulse 2s infinite;
        }

        .loader-radar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 50%;
            background: linear-gradient(45deg, transparent 50%, var(--primary-neon) 100%);
            border-radius: 100% 0 0 0;
            transform-origin: 0 0;
            animation: radarSpin 1.5s linear infinite;
        }

        @keyframes radarSpin {
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes radarPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.4);
            }

            70% {
                box-shadow: 0 0 0 20px transparent;
            }

            100% {
                box-shadow: 0 0 0 0 transparent;
            }
        }

        /* --- TOAST --- */
        .custom-toast {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--primary-neon);
            color: var(--primary-neon);
            font-family: 'Roboto Mono', monospace;
            padding: 10px 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
            font-size: 0.9rem;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .edu-grid {
                flex-direction: column;
                width: 100%;
                padding: 10px 15px;
            }

            .edu-col {
                width: 100%;
            }

            .page-header h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>

<body>
    <canvas id="hero-canvas"></canvas>

    <div class="page-header">
        <div class="tech-badge">SYSTEM: ONLINE</div>
        <h1>TỔ TOÁN - TIN</h1>
        <p>KẾT NỐI TRI THỨC // KIẾN TẠO TƯƠNG LAI</p>
    </div>

    <div class="dashboard-container" id="scroll-container">
        <div class="edu-grid" id="dynamic-grid">
            <div style="width: 100vw; display:flex; flex-direction:column; align-items:center; color:white;">
                <div class="loader-radar"></div>
                <div style="margin-top:15px; font-family:'Roboto Mono'; font-size:0.9rem; letter-spacing:1px;">
                    INITIALIZING DATABASE...</div>
            </div>
        </div>
    </div>

    <div class="page-footer">
        <div>DESIGNED BY <span>TO TOAN TIN</span> | VER 2.0</div>
        <div style="margin-top:5px;">DATA DRIVEN EDUCATION</div>
    </div>

    <div id="toast-box"></div>

    <script>
        // --- CONFIG ---
        const SHEET_ID = '1HoArwLdyt3SOLSF19L6D5Bhl0GXEYKALb2kPijZLet4';
        const SHEET_NAME = 'CSDL';

        // --- FETCH DATA ---
        async function fetchSheetData() {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                return parseData(json.table.rows);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('dynamic-grid').innerHTML = '<div style="color:#ef4444; font-family:monospace; text-align:center;">[ERROR]: CONNECTION FAILED</div>';
            }
        }

        function parseData(rows) {
            const cards = [];
            let currentCard = null, currentL1 = null, currentL2 = null;

            rows.forEach(row => {
                const c = row.c;
                if (!c || !c[0]) return;
                const level = c[0] ? c[0].v : 0;
                const icon = c[1] ? c[1].v : 'fas fa-cube';
                // Nếu màu trong sheet là đen/tối, đổi sang màu sáng cho hợp dark mode
                let color = c[2] ? c[2].v : '#0ea5e9';
                if(color === '#000000') color = '#e2e8f0'; 

                const label = c[3] ? c[3].v : 'Undefined';
                const link = c[4] ? c[4].v : '#';
                const note = c[5] ? c[5].v : '';

                const item = { level, icon, color, label, link, note, children: [] };

                if (level === 0) { currentCard = item; cards.push(currentCard); currentL1 = null; }
                else if (level === 1) { if (currentCard) { currentL1 = item; currentCard.children.push(currentL1); currentL2 = null; } }
                else if (level === 2) { if (currentL1) { currentL2 = item; currentL1.children.push(currentL2); } }
                else if (level === 3) { if (currentL2) currentL2.children.push(item); }
            });
            return cards;
        }

        // --- RENDER ---
        function renderDashboard(cards) {
            const grid = document.getElementById('dynamic-grid');
            grid.innerHTML = '';

            cards.forEach((card, index) => {
                const col = document.createElement('div');
                col.className = 'edu-col';
                col.style.animationDelay = `${index * 0.1}s`;

                const cardColor = card.color;
                
                // Style Card Header
                const cardHtml = document.createElement('div');
                cardHtml.className = 'edu-card';
                // Tạo viền trên cùng màu theo môn học
                cardHtml.style.borderTop = `3px solid ${cardColor}`;

                const headerHtml = `
                    <div class="card-header-block">
                        <div class="edu-icon-box" style="color:${cardColor}; border-color:${cardColor}; box-shadow: 0 0 10px ${cardColor}40;">
                            <i class="${card.icon}"></i>
                        </div>
                        <h3 class="edu-title" style="text-shadow: 0 0 10px ${cardColor}80;">${card.label}</h3>
                    </div>
                `;

                const menuContainer = document.createElement('div');
                menuContainer.className = 'edu-menu';
                card.children.forEach(child => menuContainer.appendChild(createMenuItem(child)));

                cardHtml.innerHTML = headerHtml;
                cardHtml.appendChild(menuContainer);
                col.appendChild(cardHtml);
                grid.appendChild(col);
            });
        }

        function createMenuItem(item) {
            const hasChildren = item.children && item.children.length > 0;
            const isLevel1 = item.level === 1;
            
            // Logic click
            let onClickAttr = '';
            if (hasChildren) onClickAttr = 'onclick="toggleSub(this)"';
            else if (item.link && item.link.length > 5) onClickAttr = `onclick="window.open('${item.link}', '_blank')"`;
            else onClickAttr = 'onclick="showToast()"';

            if (isLevel1) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="edu-menu-item" ${onClickAttr} title="${item.note || ''}">
                        <div class="menu-left">
                            <i class="${item.icon}" style="color: ${item.color}; width:20px; text-align:center;"></i>
                            <span>${item.label}</span>
                        </div>
                        ${hasChildren ? '<i class="fas fa-chevron-down rotate-icon"></i>' : ''}
                    </div>
                `;
                if (hasChildren) {
                    const subDiv = document.createElement('div');
                    subDiv.className = 'submenu';
                    item.children.forEach(c => subDiv.appendChild(createMenuItem(c)));
                    div.appendChild(subDiv);
                }
                return div;
            } else {
                // Level 2 & 3
                const wrapper = document.createElement('div');
                const content = `
                    <div class="submenu-item" ${onClickAttr} title="${item.note || ''}">
                        <span style="display:flex; align-items:center; gap:8px;">
                            ${item.level === 3 ? '<i class="fas fa-angle-right" style="font-size:0.7rem"></i>' : ''}
                            ${item.label}
                        </span>
                         ${hasChildren ? '<i class="fas fa-chevron-down rotate-icon"></i>' : ''}
                    </div>
                `;
                wrapper.innerHTML = content;
                if (hasChildren) {
                    const subSubDiv = document.createElement('div');
                    subSubDiv.className = 'submenu';
                    item.children.forEach(c => subSubDiv.appendChild(createMenuItem(c)));
                    wrapper.appendChild(subSubDiv);
                }
                return wrapper;
            }
        }

        // --- INTERACTION ---
        function toggleSub(el) {
            let sub = el.nextElementSibling;
            if(!sub) sub = el.parentElement.querySelector('.submenu'); // Fallback
            
            const icon = el.querySelector('.rotate-icon');
            if (sub && sub.classList.contains('submenu')) {
                sub.classList.toggle('active');
                if (icon) icon.classList.toggle('active');
            }
        }

        function showToast() {
            const box = document.getElementById('toast-box');
            if(box.childElementCount > 0) return;

            const t = document.createElement('div');
            t.className = 'custom-toast';
            t.innerHTML = `<i class="fas fa-terminal"></i> SYSTEM: CONTENT UPDATING...`;
            box.appendChild(t);
            setTimeout(() => { t.style.opacity = 0; setTimeout(() => t.remove(), 300); }, 2000);
        }

        // --- CANVAS: TECH NETWORK (Các nút mạng liên kết) ---
        const canvas = document.getElementById('hero-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = [];
            const count = Math.floor(width / 25); // Mật độ hạt
            
            for(let i=0; i<count; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() > 0.9 ? 2.5 : 1.5 // Có hạt to hạt nhỏ
                });
            }
        }

        function animateCanvas() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#38bdf8'; // Cyan color
            ctx.strokeStyle = 'rgba(56, 189, 248, 0.15)'; // Line color

            for(let i=0; i<particles.length; i++) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy;

                if(p.x < 0 || p.x > width) p.vx *= -1;
                if(p.y < 0 || p.y > height) p.vy *= -1;

                ctx.globalAlpha = 0.6;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                // Draw connections
                for(let j=i+1; j<particles.length; j++) {
                    let p2 = particles[j];
                    let dx = p.x - p2.x;
                    let dy = p.y - p2.y;
                    let dist = Math.sqrt(dx*dx + dy*dy);

                    if(dist < 120) {
                        ctx.beginPath();
                        ctx.lineWidth = 1 - (dist/120);
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            }
            requestAnimationFrame(animateCanvas);
        }

        // --- SCROLL HANDLING ---
        const scrollContainer = document.getElementById('scroll-container');
        scrollContainer.addEventListener('wheel', (evt) => {
            if (window.innerWidth > 768 && !evt.target.closest('.edu-menu')) {
                evt.preventDefault();
                scrollContainer.scrollLeft += evt.deltaY * 2; // Tăng tốc độ scroll
            }
        });

        window.addEventListener('resize', initCanvas);
        
        // --- START ---
        initCanvas();
        animateCanvas();
        fetchSheetData().then(data => {
            if (data) renderDashboard(data);
        });

    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TỔ TOÁN - TIN | Dashboard</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            /* Palette màu hiện đại, tươi sáng nhưng chuyên nghiệp */
            --primary-color: #3b82f6;
            --accent-color: #8b5cf6;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.8);
            --text-main: #1e293b;
            --text-sub: #475569;
            --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --shadow-hover: 0 20px 50px rgba(0, 0, 0, 0.12);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden;
        }

        /* --- BACKGROUND LUNG LINH --- */
        body {
            /* Animated Gradient Background */
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-main);
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #hero-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            /* Lớp phủ mờ nhẹ để tách biệt nội dung với các hạt */
            /* backdrop-filter: blur(1px); */ 
        }

        /* --- HEADER --- */
        .page-header {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 10px;
            z-index: 10;
            position: relative;
        }

        .page-header h1 {
            font-weight: 800;
            font-size: 3.5rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: white;
            text-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 0;
            /* Text Gradient on top of White text shadow looks cool */
            background: linear-gradient(to right, #ffffff, #e0f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
            animation: float 6s ease-in-out infinite;
        }

        .page-header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.1rem;
            margin-top: 5px;
            font-weight: 500;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .header-line {
            height: 4px;
            width: 150px;
            background: white;
            margin: 10px auto 30px;
            border-radius: 50px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        /* Hiệu ứng ánh sáng chạy qua line */
        .header-line::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.9), transparent);
            animation: shimmerLine 3s infinite;
        }

        @keyframes shimmerLine {
            100% { left: 100%; }
        }

        /* --- DASHBOARD CONTAINER --- */
        .dashboard-container {
            width: 100%;
            padding: 10px 0 60px 0;
            overflow-x: auto;
            scroll-behavior: smooth;
            /* Ẩn scrollbar mặc định của container chính để đẹp hơn */
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.5) transparent;
        }

        .edu-grid {
            display: flex;
            flex-wrap: nowrap;
            gap: 25px;
            padding: 20px 40px; /* Thêm padding 2 bên */
            min-width: min-content; /* Đảm bảo grid không bị co lại */
        }

        .edu-col {
            flex: 0 0 360px;
            min-width: 360px;
            opacity: 0; /* Ẩn để làm animation hiện ra */
            animation: slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- CARD GLASSMORPHISM --- */
        .edu-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 25px;
            height: 520px; /* Tăng chiều cao một chút */
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-light);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            /* Border top sẽ được set inline từ JS */
            border-top: 5px solid transparent; 
        }

        .edu-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 24px;
            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0.1) 100%);
            pointer-events: none;
            z-index: 0;
        }

        .edu-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-hover);
            background: rgba(255, 255, 255, 0.85);
            z-index: 5;
        }

        /* --- CARD CONTENT --- */
        .card-header-inline {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }

        .edu-icon-wrapper {
            width: 50px; height: 50px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }

        .edu-card:hover .edu-icon-wrapper {
            transform: rotate(10deg) scale(1.1);
        }

        .edu-title {
            font-weight: 800;
            font-size: 1.25rem;
            color: var(--text-main);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* --- MENU SCROLLBAR --- */
        .edu-menu {
            overflow-y: auto;
            flex-grow: 1;
            padding-right: 8px;
            position: relative;
            z-index: 1;
        }

        .edu-menu::-webkit-scrollbar {
            width: 5px;
        }
        .edu-menu::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.02);
            border-radius: 10px;
        }
        .edu-menu::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.15);
            border-radius: 10px;
        }
        .edu-menu::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }

        /* --- MENU ITEMS --- */
        .edu-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 10px;
            color: var(--text-sub);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            margin-bottom: 4px;
        }

        .edu-menu-item:hover {
            background: rgba(255, 255, 255, 0.6);
            color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }

        .menu-main-content {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        .edu-menu-item i:first-child {
            width: 35px;
            font-size: 1.1rem;
            text-align: center;
            margin-right: 5px;
            transition: 0.2s;
        }
        
        /* Hiệu ứng icon nhảy nhẹ khi hover */
        .edu-menu-item:hover i:first-child {
            transform: scale(1.2);
        }

        /* --- SUBMENU --- */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0, 1, 0, 1), margin 0.3s;
            margin-left: 10px;
            border-left: 2px dashed rgba(0,0,0,0.1); /* Đường nối đứt nét kiểu sơ đồ */
            padding-left: 5px;
        }

        .submenu.active {
            max-height: 1000px; /* Đủ lớn để hiện nội dung */
            margin-bottom: 10px;
        }

        .submenu-item {
            padding: 8px 10px 8px 15px;
            font-size: 0.95rem;
            color: var(--text-sub);
            cursor: pointer;
            border-radius: 8px;
            margin-top: 2px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: 0.2s;
            position: relative;
        }
        
        /* Dot chỉ dẫn */
        .submenu-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px; height: 6px;
            background: #cbd5e1;
            border-radius: 50%;
            transition: 0.2s;
        }

        .submenu-item:hover::before {
            background: var(--primary-color);
            box-shadow: 0 0 5px var(--primary-color);
        }

        .submenu-item:hover {
            color: var(--primary-color);
            background: rgba(255,255,255,0.5);
        }

        .submenu .submenu {
            margin-left: 15px;
            border-left: 2px dotted rgba(0,0,0,0.15);
        }
        
        .submenu .submenu .submenu-item {
            font-size: 0.85rem;
        }

        .rotate-icon {
            transition: 0.3s;
            font-size: 0.75rem;
            opacity: 0.6;
        }
        .rotate-icon.active {
            transform: rotate(180deg);
            opacity: 1;
            color: var(--primary-color);
        }

        /* --- FOOTER --- */
        .page-footer {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 0.95rem;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-top: auto;
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.3), transparent);
        }
        
        /* --- TOAST --- */
        .custom-toast {
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
            padding: 12px 30px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: fixed;
            bottom: 40px; left: 50%;
            transform: translateX(-50%) translateY(20px);
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            font-weight: 600;
            border: 1px solid rgba(255,255,255,1);
            opacity: 0;
            animation: toastUp 0.3s forwards;
        }
        
        @keyframes toastUp {
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* LOADING SPINNER STYLE */
        .loader-container {
            width: 100%;
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .spinner-ring {
            width: 50px; height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .page-header h1 { font-size: 2.5rem; }
            .edu-grid { flex-wrap: wrap; justify-content: center; padding: 10px; }
            .edu-col { flex: 0 0 100%; min-width: 100%; }
            .edu-card { height: auto; min-height: 400px; }
        }
    </style>
</head>

<body>
    <canvas id="hero-canvas"></canvas>

    <div id="toast-box"></div>

    <div class="page-header">
        <h1>TỔ TOÁN - TIN</h1>
        <p>Kho tàng tri thức & Tài nguyên số</p>
    </div>

    <div class="header-line"></div>

    <div class="dashboard-container" id="scroll-container">
        <div class="edu-grid" id="dynamic-grid">
            <div class="loader-container">
                <div class="spinner-ring"></div>
                <div>Đang kết nối cơ sở dữ liệu...</div>
            </div>
        </div>
    </div>

    <div class="page-footer">
        <div><strong>DESIGN BY TO TOAN TIN</strong></div>
        <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 5px;">Hỗ trợ truy cập nhanh đến tài nguyên học tập</div>
    </div>

    <script>
        // --- CONFIG ---
        const SHEET_ID = '1HoArwLdyt3SOLSF19L6D5Bhl0GXEYKALb2kPijZLet4';
        const SHEET_NAME = 'CSDL';

        // --- UTILS ---
        function hexToRgba(hex, alpha) {
            let c;
            if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {
                c = hex.substring(1).split('');
                if (c.length == 3) c = [c[0], c[0], c[1], c[1], c[2], c[2]];
                c = '0x' + c.join('');
                return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',' + alpha + ')';
            }
            return hex;
        }

        // --- FETCH DATA ---
        async function fetchSheetData() {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
            try {
                const response = await fetch(url);
                const text = await response.text();
                const jsonText = text.substring(47).slice(0, -2);
                const json = JSON.parse(jsonText);
                return parseData(json.table.rows);
            } catch (error) {
                console.error('Lỗi:', error);
                document.getElementById('dynamic-grid').innerHTML = '<div style="color:white; text-align:center;">Không thể tải dữ liệu. Vui lòng kiểm tra kết nối!</div>';
            }
        }

        function parseData(rows) {
            const cards = [];
            let currentCard = null, currentL1 = null, currentL2 = null;

            rows.forEach(row => {
                const c = row.c;
                if (!c || !c[0]) return;
                const level = c[0] ? c[0].v : 0;
                const icon = c[1] ? c[1].v : 'fas fa-circle';
                const color = c[2] ? c[2].v : '#333';
                const label = c[3] ? c[3].v : 'No Name';
                const link = c[4] ? c[4].v : '#';
                const note = c[5] ? c[5].v : '';

                const item = { level, icon, color, label, link, note, children: [] };

                if (level === 0) {
                    currentCard = item;
                    cards.push(currentCard);
                    currentL1 = null;
                } else if (level === 1) {
                    if (currentCard) {
                        currentL1 = item;
                        currentCard.children.push(currentL1);
                        currentL2 = null;
                    }
                } else if (level === 2) {
                    if (currentL1) {
                        currentL2 = item;
                        currentL1.children.push(currentL2);
                    }
                } else if (level === 3) {
                    if (currentL2) currentL2.children.push(item);
                }
            });
            return cards;
        }

        // --- RENDER ---
        function renderDashboard(cards) {
            const grid = document.getElementById('dynamic-grid');
            grid.innerHTML = '';

            cards.forEach((card, index) => {
                const col = document.createElement('div');
                col.className = 'edu-col';
                // Stagger Animation: Các card hiện ra lệch nhau 1 chút
                col.style.animationDelay = `${index * 0.15}s`;

                const cardColor = card.color || '#3b82f6';
                const bgIcon = hexToRgba(cardColor, 0.15);

                const cardHtml = document.createElement('div');
                cardHtml.className = 'edu-card';
                // Border top màu đậm để nhấn mạnh
                cardHtml.style.borderTopColor = cardColor;

                const headerHtml = `
                    <div class="card-header-inline">
                        <div class="edu-icon-wrapper" style="background:${bgIcon}; color:${cardColor};">
                            <i class="${card.icon}"></i>
                        </div>
                        <h3 class="edu-title">${card.label}</h3>
                    </div>
                `;

                const menuContainer = document.createElement('div');
                menuContainer.className = 'edu-menu';
                card.children.forEach(l1 => menuContainer.appendChild(createMenuItem(l1)));

                cardHtml.innerHTML = headerHtml;
                cardHtml.appendChild(menuContainer);
                col.appendChild(cardHtml);
                grid.appendChild(col);
            });
        }

        function createMenuItem(item) {
            const hasChildren = item.children && item.children.length > 0;
            const isLevel1 = item.level === 1;
            let onClickAttr = hasChildren ? 'onclick="toggleSub(this)"' : (item.link && item.link.length > 5 ? `onclick="window.open('${item.link}', '_blank')"` : 'onclick="updateNotify()"');

            if (isLevel1) {
                const div = document.createElement('div');
                const itemHtml = `
                    <div class="edu-menu-item" ${onClickAttr} title="${item.note || ''}">
                        <div class="menu-main-content">
                            <i class="${item.icon}" style="color: ${item.color}"></i> ${item.label}
                        </div>
                        ${hasChildren ? '<i class="fas fa-caret-down rotate-icon"></i>' : ''}
                    </div>
                `;
                div.innerHTML = itemHtml;
                if (hasChildren) {
                    const subDiv = document.createElement('div');
                    subDiv.className = 'submenu';
                    item.children.forEach(c => subDiv.appendChild(createMenuItem(c)));
                    div.appendChild(subDiv);
                }
                return div;
            } else {
                // Logic chung cho Level 2 & 3
                if (hasChildren) {
                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = `
                        <div class="submenu-item" ${onClickAttr} title="${item.note || ''}">
                            <div style="display:flex; align-items:center;">
                                <i class="${item.icon} menu-icon" style="color: ${item.color}; margin-right:8px; width:20px; text-align:center;"></i> ${item.label}
                            </div>
                            <i class="fas fa-caret-down rotate-icon"></i>
                        </div>
                    `;
                    const subSubDiv = document.createElement('div');
                    subSubDiv.className = 'submenu';
                    item.children.forEach(c => subSubDiv.appendChild(createMenuItem(c)));
                    wrapper.appendChild(subSubDiv);
                    return wrapper;
                } else {
                    const el = document.createElement('div');
                    el.className = 'submenu-item';
                    el.title = item.note || '';
                    el.onclick = hasChildren ? null : (item.link && item.link.length > 5 ? () => window.open(item.link, '_blank') : updateNotify);
                    el.innerHTML = `
                         <div style="display:flex; align-items:center;">
                            <i class="${item.icon}" style="color: ${item.color}; margin-right:8px; width:20px; text-align:center;"></i> ${item.label}
                        </div>
                    `;
                    return el;
                }
            }
        }

        // --- INTERACTION ---
        function toggleSub(el) {
            // Tìm submenu sibling
            let sub = el.nextElementSibling;
            if(!sub && el.parentElement.querySelector('.submenu')) {
                // Trường hợp click text bên trong, tìm từ parent
                sub = el.parentElement.querySelector('.submenu');
            }
            
            const icon = el.querySelector('.rotate-icon');
            if (sub && sub.classList.contains('submenu')) {
                sub.classList.toggle('active');
                if (icon) icon.classList.toggle('active');
            }
        }

        function updateNotify() {
            const box = document.getElementById('toast-box');
            if(box.children.length > 0) return; // Prevent spam

            const toast = document.createElement('div');
            toast.className = 'custom-toast';
            toast.innerHTML = `<i class="fas fa-tools" style="color:#fbbf24"></i><span>Nội dung đang được cập nhật...</span>`;
            box.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // --- ANIMATED CONSTELLATION CANVAS (HIỆU ỨNG TOÁN HỌC) ---
        const canvas = document.getElementById('hero-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = [];
            // Số lượng hạt phụ thuộc vào màn hình
            const count = width < 768 ? 40 : 80; 
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 2 + 1
                });
            }
        }

        function animateCanvas() {
            ctx.clearRect(0, 0, width, height);
            
            // Vẽ các đường nối (Constellation effect)
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                // Di chuyển
                p.x += p.vx;
                p.y += p.vy;

                // Dội tường
                if (p.x < 0 || p.x > width) p.vx *= -1;
                if (p.y < 0 || p.y > height) p.vy *= -1;

                // Vẽ điểm
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.fill();

                // Nối dây nếu gần nhau
                for (let j = i + 1; j < particles.length; j++) {
                    let p2 = particles[j];
                    let dist = Math.sqrt((p.x - p2.x) ** 2 + (p.y - p2.y) ** 2);
                    if (dist < 150) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.2 - dist/150})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            }
            requestAnimationFrame(animateCanvas);
        }

        // Mouse scroll horizontal fix
        const scrollContainer = document.getElementById('scroll-container');
        scrollContainer.addEventListener('wheel', (evt) => {
            if (window.innerWidth > 768 && !evt.target.closest('.edu-menu')) {
                evt.preventDefault();
                scrollContainer.scrollLeft += evt.deltaY * 1.5;
            }
        });

        window.addEventListener('resize', initCanvas);
        initCanvas();
        animateCanvas();

        // Start
        fetchSheetData().then(data => {
            if (data) renderDashboard(data);
        });

    </script>
</body>
</html>
